---
date: 2025-12-31T16:53:13-08:00
researcher: ariasulin
git_commit: 9edb6a07380fd0c3e5cf1b011ef6199a225d96e4
branch: main
repository: YouLab
topic: "Letta v0.16.1 Compatibility and Streaming Testing"
tags: [implementation, letta, compatibility, streaming, docker, postgresql]
status: in_progress
last_updated: 2025-12-31
last_updated_by: ariasulin
type: implementation_strategy
---

# Handoff: Letta v0.16.1 Compatibility Updates

## Task(s)

**Resumed from:** `thoughts/shared/handoffs/general/2025-12-31_16-20-23_phase-2-streaming-implementation.md`

**Original Goal:** Manual integration testing of Phase 2 streaming implementation (Phase 5 from the plan).

**What Actually Happened:**
1. **Letta server startup issues** - Multiple Python/dependency issues required resolution
2. **PostgreSQL upgrade** - Upgraded from PostgreSQL 14 to 17 for pgvector compatibility
3. **Docker deployment** - Switched to Docker for Letta server (handles migrations automatically)
4. **API breaking changes** - Letta v0.16.1 requires `model` and `embedding` parameters for agent creation

**Status:**
- [x] Letta server running via Docker on port 8283
- [x] LettaStarter HTTP service code updated for Letta v0.16.1 API
- [x] Schema updated for datetime `created_at` field
- [ ] Integration testing of streaming endpoint (in progress - was about to test when handoff requested)

## Critical References

- Implementation plan: `thoughts/shared/plans/2025-12-31-phase-2-streaming-implementation.md`
- Previous handoff: `thoughts/shared/handoffs/general/2025-12-31_16-20-23_phase-2-streaming-implementation.md`

## Recent changes

- `src/letta_starter/server/agents.py:110-111` - Added required `model="letta/letta-free"` and `embedding="letta/letta-free"` parameters to `client.agents.create()`
- `src/letta_starter/server/schemas.py:7-8` - Added `datetime` and `Any` imports
- `src/letta_starter/server/schemas.py:29` - Changed `created_at: int | None` to `created_at: datetime | int | None`

## Learnings

1. **Letta v0.16.1 requires PostgreSQL** - The pip install no longer works with SQLite by default. Docker is the recommended approach as it handles database migrations automatically.

2. **Letta v0.16.1 API breaking changes:**
   - `agents.create()` now REQUIRES `model` parameter (e.g., `"letta/letta-free"`)
   - `agents.create()` now REQUIRES `embedding` parameter (e.g., `"letta/letta-free"`)
   - Agent `created_at` field is now a datetime object, not an integer timestamp

3. **PostgreSQL 17 required for pgvector** - Homebrew's pgvector formula only builds for PostgreSQL 17/18, not 14.

4. **Letta Docker image** - `letta/letta:latest` bundles PostgreSQL, Redis, and handles all migrations. Much simpler than pip install.

5. **Available Letta model:** `letta/letta-free` - Letta's free inference endpoint at `https://inference.letta.com/v1/`

## Artifacts

- `src/letta_starter/server/agents.py:108-117` - Updated agent creation with model/embedding params
- `src/letta_starter/server/schemas.py` - Updated AgentResponse schema

## Action Items & Next Steps

1. **Restart LettaStarter and verify agent creation works:**
   ```bash
   lsof -ti:8100 | xargs kill 2>/dev/null || true
   uv run letta-server &
   curl -X POST http://localhost:8100/agents -H "Content-Type: application/json" \
     -d '{"user_id": "test-user", "agent_type": "tutor"}'
   ```

2. **Test streaming endpoint:**
   ```bash
   # Use agent_id from step 1
   curl -N -X POST http://localhost:8100/chat/stream \
     -H "Content-Type: application/json" \
     -d '{"agent_id": "<agent_id>", "message": "Hello!"}'
   ```

3. **Run verification:**
   ```bash
   make verify-agent
   ```
   Tests may need updates due to schema changes.

4. **Update tests** if needed for:
   - `created_at` datetime type in `test_server/test_schemas.py`
   - Mock agent creation with `model` and `embedding` params

## Other Notes

- **Letta Docker container name:** `letta` (running on port 8283)
- **To check Letta status:** `docker logs letta`
- **To stop Letta:** `docker stop letta && docker rm letta`
- **PostgreSQL 17 is now running** via `brew services` (stopped PostgreSQL 14)
- **Letta database exists** in PostgreSQL 17 with pgvector extension enabled
- The `~/.letta-venv` virtualenv was created but has dependency issues; use Docker instead
